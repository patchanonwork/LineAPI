substitutions:
  _REGION: asia-southeast1
  _REPO: cloud-run-source-deploy
  _SERVICE: line-gatekeeper-api
  _IMAGE: $_REGION-docker.pkg.dev/$PROJECT_ID/$_REPO/$_SERVICE:$SHORT_SHA

options:
  logging: CLOUD_LOGGING_ONLY

steps:
  - name: gcr.io/k8s-skaffold/pack
    args: ['build','$_IMAGE','--builder=gcr.io/buildpacks/builder','--publish','--path','.']

  - name: gcr.io/google.com/cloudsdktool/cloud-sdk
    entrypoint: gcloud
    args: ['run','deploy','$_SERVICE','--image','$_IMAGE','--region','$_REGION','--allow-unauthenticated','--port','8080']

images: ['$_IMAGE']
timeout: '1800s'
